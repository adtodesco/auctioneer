{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Nominations{% endblock %}</h1>
  {% if g.user %}
    <a class="action" href="{{ url_for('auction.nominate') }}">Nominate</a>
  {% endif %}
{% endblock %}

{% block content %}
  {% for nomination in open_nominations %}
    <hr>
    <div class="nomination opened">
      <div class="modifiable">
        <div>
          <h2>{{ nomination['name'] }} | {{ nomination['position'] }} | {{ nomination['team'] }}</h2>
          <p class="about">Nominated {{ moment(nomination['created_at']).format('LLL') }} by {{ nomination['nominator_username'] }}</p>
        </div>
        {% if g.user['is_league_manager'] == True %}
          <a class="action" href="{{ url_for('auction.update', id=nomination['id']) }}">Edit</a>
        {% endif %}
      </div>
      <div>
        <p class="status">Auction ends: {{ moment(nomination['ends_at']).format('LLL') }}</p>
        {% if nomination['matcher_id'] %}
        <p class="match">Match rights: {{ nomination['matcher_username'] }}</p>
        {% endif %}
      </div>
      {% if g.user %}
      <div class="modifiable">
        <div>
          <p class="bid">{{ g.user['username'] }}'s current bid: {{ nomination['user_value'] }}</p>
        </div>
        <a class="action" href="{{ url_for('auction.bid', id=nomination['id']) }}">Bid</a>
      </div>
      {% endif %}
    </div>
  {% endfor %}

  {% for nomination in match_nominations %}
    <hr>
    <div class="nomination matching">
      <div class="modifiable">
        <div>
          <h2>{{ nomination['name'] }} | {{ nomination['position'] }} | {{ nomination['team'] }}</h2>
          <p class="about">Nominated {{ moment(nomination['created_at']).format('LLL') }} by {{ nomination['nominator_username'] }}</p>
        </div>
        {% if g.user['is_league_manager'] == True %}
          <a class="action" href="{{ url_for('auction.update', id=nomination['id']) }}">Edit</a>
        {% endif %}
      </div>
      {% if g.user['id'] == nomination['match_id'] %}
      <div class="modifiable">
        <div>
          <p class="bid">Winning bid for {{ nomination['name'] }}: {{ nomination['value'] }}</p>
        </div>
        <a class="action" href="{{ url_for('auction.match', id=nomination['id']) }}">Match</a>
      </div >
      {% endif %}
    </div>
  {% endfor %}

  {% for nomination in closed_nominations %}
    <hr>
    <div class="nomination closed">
      <div class="modifiable">
        <div>
          <h2>{{ nomination['name'] }} | {{ nomination['position'] }} | {{ nomination['team'] }}</h2>
          <p class="about">Nominated {{ moment(nomination['created_at']).format('LLL') }} by {{ nomination['nominator_username'] }}</p>
        </div>
        {% if g.user['is_league_manager'] == True %}
          <a class="action" href="{{ url_for('auction.update', id=nomination['id']) }}">Edit</a>
        {% endif %}
      </div>
      <div>
        <p class="status">Auction is closed! {{ nomination["winner_username"] }} won the auction with a bid of ${{ nomination["winner_value"] }}.</p>
      </div>
    </div>
  {% endfor %}
{% endblock %}