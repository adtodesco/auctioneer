{% extends 'base.html' %}

{% block header %}
<h1>{% block title %}Auction{% endblock %}</h1>
{% if g.user %}
<a class="action" href="{{ url_for('auction.nominate') }}">Nominate</a>
<a class="action" href="{{ url_for('auction.results') }}">Download results</a>
{% endif %}
{% endblock %}

{% block content %}
<hr>
{% if not open_nominations and not match_nominations and not closed_nominations %}
<p><i>No nominations, yet...</i></p>
{% else %}
{% for nomination in open_nominations %}
<div class="auction-card auction-card-open">
    <div class="auction-card-header">
        <div class="auction-card-title">
            <h3>{{ nomination.Nomination.player.name }}</h3>
            <span class="player-meta">{{ nomination.Nomination.player.team }} ‚Ä¢ {{ nomination.Nomination.player.position.replace(",", ", ") }}</span>
        </div>
        <span class="status-badge status-badge-open">OPEN</span>
    </div>

    <div class="auction-card-body">
        <div class="auction-info-row">
            <span class="label">Nominated by:</span>
            <span class="value">{{ nomination.Nomination.nominator_user.team_name }}</span>
        </div>
        <div class="auction-info-row">
            <span class="label">Closes:</span>
            <span class="value">{{ moment(nomination.Nomination.slot.closes_at).format('MMM D, h:mm A') }} (Round {{ nomination.Nomination.slot.round }})</span>
        </div>
        {% if nomination.Nomination.player.matcher_id %}
        <div class="auction-info-row">
            <span class="label">Match rights:</span>
            <span class="value"><strong>{{ nomination.Nomination.player.matcher_user.team_name }}</strong></span>
        </div>
        {% endif %}
        {% if g.user %}
        <div class="auction-info-row">
            <span class="label">{{ g.user.team_name }}'s bid:</span>
            <span class="value"><strong>{% if nomination.Bid.value %}${{ nomination.Bid.value }}{% else %}‚Äî{% endif %}</strong></span>
        </div>
        {% endif %}
    </div>

    <div class="auction-card-actions">
        {% if g.user %}
        <a class="btn btn-primary" href="{{ url_for('auction.bid', nomination_id=nomination.Nomination.id) }}">Place Bid</a>
        {% endif %}
        {% if g.user.is_league_manager == True %}
        <a class="btn btn-secondary" href="{{ url_for('auction.edit', nomination_id=nomination.Nomination.id) }}">Edit</a>
        {% endif %}
    </div>
</div>
{% endfor %}

{% for nomination in match_nominations %}
<div class="auction-card auction-card-matching">
    <div class="auction-card-header">
        <div class="auction-card-title">
            <h3>{{ nomination.Nomination.player.name }}</h3>
            <span class="player-meta">{{ nomination.Nomination.player.team }} ‚Ä¢ {{ nomination.Nomination.player.position.replace(",", ", ") }}</span>
        </div>
        <span class="status-badge status-badge-matching">MATCHING</span>
    </div>

    <div class="auction-card-body">
        <div class="auction-info-row">
            <span class="label">Nominated by:</span>
            <span class="value">{{ nomination.Nomination.nominator_user.team_name }}</span>
        </div>
        <div class="auction-info-row">
            <span class="label">Closed:</span>
            <span class="value">{{ moment(nomination.Nomination.slot.closes_at).format('MMM D, h:mm A') }} (Round {{ nomination.Nomination.slot.round }})</span>
        </div>
        <div class="auction-info-row">
            <span class="label">Winning bid:</span>
            <span class="value"><strong>${{ nomination.Nomination.bids[0].value }}</strong></span>
        </div>
        <div class="auction-alert">
            <strong>{{ nomination.Nomination.player.matcher_user.team_name }}</strong> has 24 hours to match
        </div>
    </div>

    <div class="auction-card-actions">
        {% if g.user.id == nomination.Nomination.player.matcher_id %}
        <a class="btn btn-primary" href="{{ url_for('auction.match', nomination_id=nomination.Nomination.id) }}">Match Bid</a>
        {% endif %}
        {% if g.user.is_league_manager == True %}
        <a class="btn btn-secondary" href="{{ url_for('auction.edit', nomination_id=nomination.Nomination.id) }}">Edit</a>
        {% endif %}
    </div>
</div>
{% endfor %}

{% for nomination in closed_nominations %}
<div class="auction-card auction-card-closed">
    <div class="auction-card-header">
        <div class="auction-card-title">
            <h3>{{ nomination.Nomination.player.name }}</h3>
            <span class="player-meta">{{ nomination.Nomination.player.team }} ‚Ä¢ {{ nomination.Nomination.player.position.replace(",", ", ") }}</span>
        </div>
        <span class="status-badge status-badge-closed">CLOSED</span>
    </div>

    <div class="auction-card-body">
        <div class="auction-info-row">
            <span class="label">Nominated by:</span>
            <span class="value">{{ nomination.Nomination.nominator_user.team_name }}</span>
        </div>
        <div class="auction-info-row">
            <span class="label">Closed:</span>
            <span class="value">{{ moment(nomination.Nomination.slot.closes_at).format('MMM D, h:mm A') }} (Round {{ nomination.Nomination.slot.round }})</span>
        </div>
        <div class="auction-winner">
            üèÜ <strong>{{ nomination.Nomination.player.manager_user.team_name }}</strong> won with a bid of <strong>${{ nomination.Nomination.bids[0].value }}</strong>
        </div>
        <div class="auction-info-row">
            <span class="label">All bids:</span>
            <span class="value">${{ nomination.Nomination.bids[0].value }}{% for bid in nomination.Nomination.bids[1:] %}{% if bid.value %}, ${{ bid.value }}{% endif %}{% endfor %}</span>
        </div>
    </div>

    <div class="auction-card-actions">
        {% if g.user.id == nomination.Nomination.player.manager_id %}
        <a class="btn btn-primary" href="{{ url_for('auction.sign', player_id=nomination.Nomination.player.id) }}">Sign Player</a>
        {% endif %}
        {% if g.user.is_league_manager == True %}
        <a class="btn btn-secondary" href="{{ url_for('auction.edit', nomination_id=nomination.Nomination.id) }}">Edit</a>
        {% endif %}
    </div>
</div>
{% endfor %}
{% endif %}
{% endblock %}
